# ==============================================================================
# 企业级网络爬虫开发环境模板
# 适用于：Web数据采集、API集成、浏览器自动化、分布式爬虫、反检测
# Python 版本：参数化支持 3.9-3.12  
# ==============================================================================

# 💻 系统配置要求
# 最低配置：16GB RAM, 15GB 可用磁盘空间, 稳定网络连接
# 推荐配置：32GB RAM, 30GB 可用磁盘空间, 高带宽网络
# 高性能配置：64GB+ RAM, 50GB+ 可用磁盘空间, 多IP代理池
# 包大小估算：~5.2GB (完整的企业级爬虫工具链)
# 支持系统：Windows 11+, macOS 12+, Linux (Ubuntu 20.04+)
# 安装时间：25-45分钟 (包含浏览器下载)
# 网络要求：高速稳定连接，代理服务支持
# 特殊说明：需要配置用户代理轮换和代理池，遵循robots.txt

name: enterprise-webscraping{{ '-' + suffix if suffix else '' }}

channels:
  - conda-forge
  - defaults

dependencies:
  # -----------------------------------------------------------------------------
  # 核心 Python 环境
  # -----------------------------------------------------------------------------
  - python={{ python_version }}.*           # Python 解释器 (3.11为异步性能最优)
  - pip                                      # Python 包管理器
  - setuptools>=69.0,<70.0                  # Python 包构建工具
  - wheel>=0.43,<1.0                        # 二进制包分发

  # -----------------------------------------------------------------------------
  # HTTP 和异步网络框架
  # -----------------------------------------------------------------------------
  - requests>=2.32,<3.0                     # 同步 HTTP 客户端
  - aiohttp>=3.9,<4.0                       # 异步 HTTP 客户端
  - httpx>=0.27,<1.0                        # 现代同步/异步 HTTP 客户端

  # -----------------------------------------------------------------------------
  # HTML/XML 解析引擎 (高性能)
  # -----------------------------------------------------------------------------
  - lxml>=5.1,<6.0                          # 快速C语言XML/HTML解析器
  - beautifulsoup4>=4.12,<5.0               # 灵活的HTML解析器
  - cssselect>=1.2,<2.0                     # CSS选择器支持
  - html5lib>=1.1,<2.0                      # 标准兼容HTML解析器

  # -----------------------------------------------------------------------------
  # 数据处理和存储
  # -----------------------------------------------------------------------------
  - pandas>=2.1,<3.0                        # 数据分析和处理
  - numpy>=1.26,<2.0                        # 数值计算基础
  - sqlalchemy>=2.0,<3.0                    # 数据库 ORM
  - redis-py>=5.0,<6.0                      # Redis 缓存客户端

  # -----------------------------------------------------------------------------
  # 数据序列化和格式支持
  # -----------------------------------------------------------------------------
  - openpyxl>=3.1,<4.0                      # Excel 文件读写
  - xlsxwriter>=3.1,<4.0                    # Excel 写入优化
  - h5py>=3.10,<4.0                         # HDF5 大数据集存储

  # -----------------------------------------------------------------------------
  # 开发和测试工具
  # -----------------------------------------------------------------------------
  - pytest>=7.4,<8.0                        # 测试框架
  - pytest-asyncio>=0.23,<1.0               # 异步测试支持
  - black>=23.0,<25.0                       # 代码格式化
  - ruff>=0.1.0,<1.0                        # 快速Python代码检查器

  # -----------------------------------------------------------------------------
  # 系统和网络工具
  # -----------------------------------------------------------------------------
  - python-dotenv>=1.0,<2.0                 # 环境变量管理
  - click>=8.1,<9.0                         # CLI 工具开发框架
  - tqdm>=4.66,<5.0                         # 进度条显示
  - psutil>=5.9,<6.0                        # 系统资源监控

  # -----------------------------------------------------------------------------
  # pip 依赖 (爬虫专用工具生态)
  # -----------------------------------------------------------------------------
  - pip:
    # =========================================================================
    # 🌐 现代浏览器自动化 (Playwright 优先)
    # =========================================================================
    - playwright>=1.40.0,<2.0               # 现代高性能浏览器自动化
    - selenium>=4.16.0,<5.0                 # 传统浏览器自动化兼容
    - selenium-stealth>=1.0.6,<2.0          # Selenium 反检测增强
    - webdriver-manager>=4.0.0,<5.0         # 浏览器驱动自动管理

    # =========================================================================
    # 🕷️ 高级爬虫框架和引擎
    # =========================================================================
    - scrapy>=2.11.0,<3.0                   # 生产级分布式爬虫框架
    - scrapy-playwright>=0.0.33,<1.0        # Scrapy + Playwright 集成
    - scrapy-redis>=0.7.3,<1.0              # Scrapy 分布式支持
    - scrapy-splash>=0.8.0,<1.0             # JavaScript 渲染支持
    - scrapyd>=1.3.0,<2.0                   # Scrapy 守护进程和部署

    # =========================================================================
    # 🥷 反检测和隐私保护
    # =========================================================================
    - undetected-chromedriver>=3.5.0,<4.0   # Chrome 反检测绕过
    - fake-useragent>=1.4.0,<2.0            # 用户代理字符串轮换
    - python-anticaptcha>=0.7.1,<1.0        # 验证码识别服务
    - curl-cffi>=0.6.0,<1.0                 # TLS 指纹匹配和伪装
    - cloudscraper>=1.2.71,<2.0             # Cloudflare 反机器人绕过

    # =========================================================================
    # 🔄 代理和网络管理
    # =========================================================================
    - requests-oauthlib>=1.3.1,<2.0         # OAuth 认证支持
    - httpx-socks>=0.8.0,<1.0               # SOCKS 代理支持
    - aiohttp-socks>=0.8.0,<1.0             # 异步 SOCKS 代理
    - rotating-proxies>=0.6.3,<1.0          # 代理轮换中间件
    - pysocks>=1.7.1,<2.0                   # SOCKS 代理基础库

    # =========================================================================
    # ⚡ 分布式处理和任务队列
    # =========================================================================
    - celery>=5.3.0,<6.0                    # 分布式任务队列
    - kombu>=5.3.0,<6.0                     # 消息队列抽象层
    - flower>=2.0.1,<3.0                    # Celery 监控和管理
    - dramatiq>=1.15.0,<2.0                 # 轻量级任务队列替代方案
    - rq>=1.15.0,<2.0                       # Redis 队列

    # =========================================================================
    # 📄 数据提取和内容处理
    # =========================================================================
    - jsonlines>=4.0.0,<5.0                 # JSONL 格式处理
    - feedparser>=6.0.10,<7.0               # RSS/Atom 数据源解析
    - newspaper3k>=0.2.8,<1.0               # 新闻文章智能提取
    - readability-lxml>=0.8.1,<1.0          # 网页主要内容提取
    - trafilatura>=1.6.0,<2.0               # 高质量文本提取
    - boilerpy3>=1.0.7,<2.0                 # 样板文本移除

    # =========================================================================
    # 🗄️ 数据存储和数据库集成
    # =========================================================================
    - pymongo>=4.6.0,<5.0                   # MongoDB 文档数据库
    - psycopg2-binary>=2.9.9,<3.0           # PostgreSQL 关系数据库
    - aiomysql>=0.2.0,<1.0                  # 异步 MySQL 客户端
    - aioredis>=2.0.1,<3.0                  # 异步 Redis 客户端
    - elasticsearch>=8.11.0,<9.0            # Elasticsearch 搜索引擎
    - motor>=3.3.0,<4.0                     # 异步 MongoDB 客户端

    # =========================================================================
    # 🖼️ 图像和媒体文件处理
    # =========================================================================
    - pillow>=10.1.0,<11.0                  # 图像处理和格式转换
    - python-magic>=0.4.27,<1.0             # 文件类型智能检测
    - pdfplumber>=0.10.0,<1.0               # PDF 文本和表格提取
    - pytesseract>=0.3.10,<1.0              # OCR 文字识别
    - opencv-python>=4.8.0,<5.0             # 计算机视觉图像处理

    # =========================================================================
    # 📱 社交媒体和 API 集成
    # =========================================================================
    - tweepy>=4.14.0,<5.0                   # Twitter API v2 客户端
    - praw>=7.7.0,<8.0                      # Reddit API 官方客户端
    - facebook-sdk>=3.1.0,<4.0              # Facebook Graph API
    - instaloader>=4.10.0,<5.0              # Instagram 数据下载
    - youtube-dl>=2021.12.17                # YouTube 视频下载
    - yt-dlp>=2023.12.30                    # YouTube-dl 增强版本

    # =========================================================================
    # 🔍 搜索引擎和 SEO 工具
    # =========================================================================
    - googlesearch-python>=1.2.3,<2.0       # Google 搜索结果抓取
    - duckduckgo-search>=3.9.0,<4.0         # DuckDuckGo 搜索 API
    - advertools>=0.14.0,<1.0               # SEO 和 SEM 分析工具
    - requests-html>=0.10.0,<1.0            # JavaScript 支持的 HTTP 库

    # =========================================================================
    # 📊 数据验证和清洗
    # =========================================================================
    - validators>=0.22.0,<1.0               # 数据格式验证工具
    - python-dateutil>=2.8.0,<3.0          # 日期时间解析和处理
    - phonenumbers>=8.13.0,<9.0             # 电话号码解析和验证
    - email-validator>=2.1.0,<3.0           # 邮箱地址验证
    - price-parser>=0.3.4,<1.0              # 价格信息解析

    # =========================================================================
    # 🌐 网络协议和通信
    # =========================================================================
    - websockets>=12.0,<13.0                # WebSocket 协议支持
    - websocket-client>=1.7.0,<2.0          # WebSocket 客户端
    - ftplib>=3.11,<4.0                     # FTP 协议客户端
    - imaplib>=3.11,<4.0                    # IMAP 邮件协议
    - paramiko>=3.4.0,<4.0                  # SSH 客户端和服务器

    # =========================================================================
    # 📈 监控和性能分析
    # =========================================================================
    - requests-cache>=1.1.0,<2.0            # HTTP 请求缓存
    - cachetools>=5.3.0,<6.0                # 高级缓存工具
    - memory-profiler>=0.61.0,<1.0          # 内存使用分析
    - line-profiler>=4.1.0,<5.0             # 逐行性能分析
    - py-spy>=0.3.14,<1.0                   # 运行时性能监控

    # =========================================================================
    # 🔧 实用工具和库
    # =========================================================================
    - rich>=13.7.0,<14.0                    # 富文本终端输出
    - typer>=0.9.0,<1.0                     # 现代 CLI 框架
    - loguru>=0.7.0,<1.0                    # 强大的日志记录库
    - tenacity>=8.2.0,<9.0                  # 重试和容错机制
    - schedule>=1.2.0,<2.0                  # 任务调度和定时执行
    - python-slugify>=8.0.0,<9.0            # URL 友好字符串转换

    # =========================================================================
    # 🛡️ 安全和合规工具
    # =========================================================================
    - cryptography>=41.0.0,<42.0            # 加密和安全通信
    - requests-toolbelt>=1.0.0,<2.0         # HTTP 工具扩展
    - urllib3>=2.0.0,<3.0                   # HTTP 客户端基础库
    - certifi>=2023.11.17                   # CA 证书束
    - chardet>=5.2.0,<6.0                   # 字符编码检测

# 环境变量配置
variables:
  # 浏览器和爬虫配置
  PLAYWRIGHT_BROWSERS_PATH: ~/.cache/playwright
  SCRAPY_SETTINGS_MODULE: settings.production
  
  # 用户代理和身份伪装
  USER_AGENT: "Mozilla/5.0 (compatible; Enterprise-Bot/1.0; +http://www.example.com/bot)"
  DEFAULT_REQUEST_HEADERS: '{"Accept-Language": "en-US,en;q=0.9"}'
  
  # 性能和并发配置
  CONCURRENT_REQUESTS: "16"
  CONCURRENT_REQUESTS_PER_DOMAIN: "8"
  DOWNLOAD_DELAY: "1"
  RANDOMIZE_DOWNLOAD_DELAY: "0.5"
  
  # 网络和重试配置
  RETRY_TIMES: "3"
  RETRY_HTTP_CODES: "500,502,503,504,408,429"
  DOWNLOAD_TIMEOUT: "180"
  
  # 数据存储配置
  REDIS_URL: "redis://localhost:6379/0"
  MONGODB_URI: "mongodb://localhost:27017/"
  ELASTICSEARCH_HOST: "localhost:9200"
  
  # 反检测配置
  ROTATING_PROXY_LIST_PATH: "./proxies.txt"
  CAPTCHA_SERVICE_API_KEY: ""
  CLOUDFLARE_BYPASS_ENABLED: "true"
  
  # 日志和监控
  LOG_LEVEL: "INFO"
  STATS_CLASS: "scrapy.statscollectors.MemoryStatsCollector"
  TELNETCONSOLE_ENABLED: "false"

# ==============================================================================
# 环境说明
# ==============================================================================
# 
# 🎯 主要用途：
# • 大规模 Web 数据采集和抓取
# • 电商价格监控和竞品分析
# • 社交媒体内容聚合和分析
# • 新闻资讯自动化收集
# • API 数据集成和同步
# • 网站结构化数据提取
# 
# 📋 核心功能：
# • Playwright/Selenium 浏览器自动化
# • Scrapy 分布式爬虫框架
# • 异步高并发数据采集
# • 反检测和反爬虫绕过
# • 多格式数据解析和清洗
# • 分布式任务队列处理
# 
# 🛠️ 支持的数据源：
# • HTML/XML 网页内容
# • JSON/REST API 接口
# • RSS/Atom 订阅源
# • 社交媒体平台 (Twitter, Reddit, Facebook)
# • 电商平台产品信息
# • 新闻媒体文章内容
# • PDF 文档和图像文本 (OCR)
# 
# ⚡ 性能特性：
# • 异步 I/O 并发处理 (50-100倍性能提升)
# • 智能代理轮换和负载均衡
# • 分布式任务队列和集群部署
# • 增量抓取和数据去重
# • 自适应延迟和速率限制
# 
# 🛡️ 反检测能力：
# • 用户代理轮换和指纹伪造
# • TLS 指纹匹配和规避
# • 验证码自动识别和处理
# • IP 代理池管理
# • 行为模式智能模拟
# 
# 🗄️ 数据存储支持：
# • 关系数据库 (PostgreSQL, MySQL)
# • 文档数据库 (MongoDB)
# • 搜索引擎 (Elasticsearch)
# • 缓存数据库 (Redis)
# • 文件格式 (JSON, CSV, Excel, Parquet)
# 
# 🔐 企业合规：
# • robots.txt 遵循和解析
# • 速率限制和礼貌性延迟
# • 数据隐私保护和脱敏
# • 访问日志记录和审计
# • 法律合规检查工具
