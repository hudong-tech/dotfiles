# ==============================================================================
# çŽ°ä»£ API å¼€å‘çŽ¯å¢ƒ
# æ ¸å¿ƒå®šä½ï¼šçŽ°ä»£ Web API å¼€å‘ï¼Œå¾®æœåŠ¡æž¶æž„
# ç›®æ ‡ç”¨æˆ·ï¼šåŽç«¯å¼€å‘è€…ã€API å¼€å‘è€…ã€å¾®æœåŠ¡å·¥ç¨‹å¸ˆ
# å·¥ä½œæµç¨‹ï¼šAPI è®¾è®¡ â†’ å¼€å‘ â†’ æµ‹è¯• â†’ æ–‡æ¡£ â†’ éƒ¨ç½²
# Python ç‰ˆæœ¬ï¼š3.9 / 3.10 / 3.11ï¼ˆå‚æ•°åŒ–æ”¯æŒï¼‰
# ==============================================================================

# ðŸ’» ç³»ç»Ÿé…ç½®è¦æ±‚
# æœ€ä½Žé…ç½®ï¼š4GB RAM, 2GB å¯ç”¨ç£ç›˜ç©ºé—´
# æŽ¨èé…ç½®ï¼š8GB RAM, 4GB å¯ç”¨ç£ç›˜ç©ºé—´
# ç”Ÿäº§çŽ¯å¢ƒï¼š16GB+ RAM, 10GB+ å¯ç”¨ç£ç›˜ç©ºé—´ (é«˜å¹¶å‘éƒ¨ç½²)
# åŒ…å¤§å°ä¼°ç®—ï¼š~1.2GB (çŽ°ä»£ API å¼€å‘å·¥å…·é“¾)
# æ”¯æŒç³»ç»Ÿï¼šWindows 10+, macOS 10.14+, Linux (Ubuntu 18.04+)
# å®‰è£…æ—¶é—´ï¼š10-20åˆ†é’Ÿ (å–å†³äºŽç½‘ç»œé€Ÿåº¦)
# CPUå»ºè®®ï¼šå››æ ¸+ å¤„ç†å™¨ (å¹¶å‘è¯·æ±‚å¤„ç†)
# ç‰¹æ®Šè¯´æ˜Žï¼šå¼€å‘é˜¶æ®µéœ€è¦ç¨³å®šç½‘ç»œè¿žæŽ¥ (API æµ‹è¯•å’Œè°ƒè¯•)

name: web-fastapi-{{PYTHON_VERSION}}

channels:
  - conda-forge
  - defaults

dependencies:
  # -----------------------------------------------------------------------------
  # æ ¸å¿ƒ Python çŽ¯å¢ƒ
  # -----------------------------------------------------------------------------
  - python={{PYTHON_VERSION}}.*      # Python è§£é‡Šå™¨ï¼ˆå‚æ•°åŒ–ç‰ˆæœ¬ï¼‰
  - pip                              # Python åŒ…ç®¡ç†å™¨

  # -----------------------------------------------------------------------------
  # Web æ¡†æž¶æ ¸å¿ƒ
  # -----------------------------------------------------------------------------
  - fastapi>=0.100,<1.0              # çŽ°ä»£å¼‚æ­¥ Web æ¡†æž¶
  - uvicorn>=0.20,<1.0               # ASGI æœåŠ¡å™¨
  - starlette>=0.27,<1.0             # FastAPI åº•å±‚æ¡†æž¶

  # -----------------------------------------------------------------------------
  # æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
  # -----------------------------------------------------------------------------
  - pydantic>=2.0,<3.0               # æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†
  - email-validator>=2.0,<3.0       # é‚®ç®±éªŒè¯æ”¯æŒ
  - orjson>=3.8,<4.0                 # é«˜æ€§èƒ½ JSON åºåˆ—åŒ–
  - msgpack>=1.0,<2.0                # é«˜æ•ˆäºŒè¿›åˆ¶åºåˆ—åŒ–

  # -----------------------------------------------------------------------------
  # æ•°æ®åº“å’Œ ORM
  # -----------------------------------------------------------------------------
  - sqlalchemy>=2.0,<3.0            # Python SQL å·¥å…·åŒ…å’Œ ORM
  - alembic>=1.10,<2.0               # æ•°æ®åº“è¿ç§»å·¥å…·
  - psycopg2>=2.9,<3.0               # PostgreSQL é€‚é…å™¨
  - asyncpg>=0.27,<1.0               # å¼‚æ­¥ PostgreSQL é©±åŠ¨

  # -----------------------------------------------------------------------------
  # HTTP å®¢æˆ·ç«¯å’Œç½‘ç»œ
  # -----------------------------------------------------------------------------
  - httpx>=0.24,<1.0                 # çŽ°ä»£å¼‚æ­¥ HTTP å®¢æˆ·ç«¯
  - requests>=2.28,<3.0              # ä¼ ç»Ÿ HTTP è¯·æ±‚åº“
  - aiofiles>=23.0,<24.0             # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
  - python-multipart>=0.0.6,<1.0    # æ–‡ä»¶ä¸Šä¼ æ”¯æŒ

  # -----------------------------------------------------------------------------
  # è®¤è¯å’Œå®‰å…¨
  # -----------------------------------------------------------------------------
  - python-jose>=3.3,<4.0           # JWT ä»¤ç‰Œå¤„ç†
  - passlib>=1.7,<2.0               # å¯†ç å“ˆå¸Œå¤„ç†
  - cryptography>=40.0,<42.0        # åŠ å¯†åº“
  - bcrypt>=4.0,<5.0                 # å¯†ç å“ˆå¸Œç®—æ³•

  # -----------------------------------------------------------------------------
  # API å¼€å‘å·¥å…·
  # -----------------------------------------------------------------------------
  - python-dotenv>=1.0,<2.0         # çŽ¯å¢ƒå˜é‡ç®¡ç†
  - python-dateutil>=2.8,<3.0       # æ—¥æœŸæ—¶é—´å¤„ç†

  # -----------------------------------------------------------------------------
  # æµ‹è¯•å·¥å…·
  # -----------------------------------------------------------------------------
  - pytest>=7.2,<9.0                # æµ‹è¯•æ¡†æž¶
  - pytest-asyncio>=0.21,<1.0       # å¼‚æ­¥æµ‹è¯•æ”¯æŒ
  - pytest-cov>=4.0,<6.0            # æµ‹è¯•è¦†ç›–çŽ‡

  # -----------------------------------------------------------------------------
  # ç›‘æŽ§å’Œæ—¥å¿—
  # -----------------------------------------------------------------------------
  - structlog>=23.1,<24.0           # ç»“æž„åŒ–æ—¥å¿—è®°å½•
  - prometheus-client>=0.16,<1.0    # ç›‘æŽ§æŒ‡æ ‡æ”¶é›†

  # -----------------------------------------------------------------------------
  # å¼€å‘å·¥å…·å’Œ CLI
  # -----------------------------------------------------------------------------
  - typer>=0.9,<1.0                 # CLI åº”ç”¨æ¡†æž¶
  - rich>=13.0,<14.0                # ç»ˆç«¯ç¾ŽåŒ–å’Œæ ¼å¼åŒ–
  # -----------------------------------------------------------------------------
  # æ•°æ®éªŒè¯æ‰©å±•
  # -----------------------------------------------------------------------------
  - phonenumbers>=8.13,<9.0         # å›½é™…ç”µè¯å·ç éªŒè¯

  # -----------------------------------------------------------------------------
  # å¼€å‘å·¥å…·
  # -----------------------------------------------------------------------------
  - black>=23.0,<25.0                # ä»£ç æ ¼å¼åŒ–å·¥å…·
  - mypy>=1.0,<2.0                   # é™æ€ç±»åž‹æ£€æŸ¥
  - ipython>=8.10,<9.0               # å¢žå¼ºçš„äº¤äº’å¼ Python shell

  # -----------------------------------------------------------------------------
  # é…ç½®æ–‡ä»¶å¤„ç†
  # -----------------------------------------------------------------------------
  - pyyaml>=6.0,<7.0                 # YAML é…ç½®æ–‡ä»¶è§£æž
  - toml>=0.10,<1.0                  # TOML é…ç½®æ–‡ä»¶è§£æž

  # -----------------------------------------------------------------------------
  # pip ä¾èµ–ï¼ˆconda ç‰ˆæœ¬å¯èƒ½æ»žåŽçš„åŒ…ï¼‰
  # -----------------------------------------------------------------------------
  - pip:
    - databases[postgresql]>=0.7,<1.0  # å¼‚æ­¥æ•°æ®åº“æ”¯æŒ
    - gunicorn>=20.1,<22.0              # WSGI æœåŠ¡å™¨ï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰
    - redis>=4.5,<5.0                   # Redis å®¢æˆ·ç«¯
    - celery>=5.2,<6.0                  # åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
    - fastapi-users>=12.0,<13.0        # ç”¨æˆ·è®¤è¯ç®¡ç†
    - slowapi>=0.1.8,<1.0               # è¯·æ±‚é™æµ

# ==============================================================================
# çŽ¯å¢ƒè¯´æ˜Ž
# ==============================================================================
# 
# ðŸŽ¯ é€‚ç”¨åœºæ™¯ï¼š
#   - RESTful API å¼€å‘
#   - å¾®æœåŠ¡æž¶æž„åº”ç”¨
#   - å¼‚æ­¥ Web åº”ç”¨å¼€å‘
#   - API ç½‘å…³å’Œä¸­é—´ä»¶
#   - çŽ°ä»£åŽç«¯æœåŠ¡å¼€å‘
#
# ðŸ“¦ åŒ…å«åŠŸèƒ½ï¼š
#   - âœ… çŽ°ä»£å¼‚æ­¥ Web æ¡†æž¶ï¼ˆFastAPI + Uvicornï¼‰
#   - âœ… å®Œæ•´çš„æ•°æ®éªŒè¯ï¼ˆPydantic v2ï¼‰
#   - âœ… æ•°æ®åº“é›†æˆï¼ˆSQLAlchemy + Alembicï¼‰
#   - âœ… å¼‚æ­¥æ•°æ®åº“æ”¯æŒï¼ˆasyncpg + databasesï¼‰
#   - âœ… è®¤è¯å’Œå®‰å…¨ï¼ˆJWT + å¯†ç å“ˆå¸Œï¼‰
#   - âœ… çŽ°ä»£ HTTP å®¢æˆ·ç«¯ï¼ˆhttpxï¼‰
#   - âœ… å®Œæ•´çš„æµ‹è¯•å·¥å…·é“¾
#   - âœ… ç”Ÿäº§çŽ¯å¢ƒæ”¯æŒï¼ˆgunicorn + redis + celeryï¼‰
#
# ðŸš€ åˆ›å»ºçŽ¯å¢ƒï¼š
#   conda_create_from_template web-fastapi myapi 3.10
#   conda_create_from_template web-fastapi microservice 3.11
#
# ðŸ“ˆ å‡çº§è·¯å¾„ï¼š
#   - Django é¡¹ç›® â†’ web-django æ¨¡æ¿
#   - æœºå™¨å­¦ä¹  API â†’ ç»“åˆ machinelearning æ¨¡æ¿
#   - æ•°æ® API â†’ ç»“åˆ datascience æ¨¡æ¿
#
# ðŸ’¡ ä½¿ç”¨æç¤ºï¼š
#   - å¼€å‘æœåŠ¡å™¨: uvicorn main:app --reload
#   - ç”Ÿäº§æœåŠ¡å™¨: gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker
#   - API æ–‡æ¡£: http://localhost:8000/docs
#   - ä¸“æ³¨ API å¼€å‘ï¼ŒåŒ…å«å®Œæ•´çš„å¼‚æ­¥æ”¯æŒ
#
# ðŸ”§ å…¸åž‹å·¥ä½œæµï¼š
#   conda activate myapi
#   # åˆ›å»º FastAPI åº”ç”¨
#   # å®šä¹‰ Pydantic æ¨¡åž‹
#   # è®¾ç½®æ•°æ®åº“è¿žæŽ¥
#   # å®žçŽ° API ç«¯ç‚¹
#   # æ·»åŠ è®¤è¯å’Œå®‰å…¨
#   uvicorn main:app --reload         # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
#   pytest tests/                     # è¿è¡Œ API æµ‹è¯•